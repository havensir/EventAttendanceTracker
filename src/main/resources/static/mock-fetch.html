<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>JoinUp ‚Ä¢ API Route Tester</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <style>
    :root {
      --bg: #f8fafc;
      --surface: #ffffff;
      --card: #f1f5f9;
      --text: #0f172a;
      --muted: #64748b;
      --border: #e2e8f0;
      --ok: #10b981;
      --bad: #ef4444;
      --warn: #f59e0b;
      --accent: #3b82f6;
      --accent-hover: #2563eb;
      --accent-light: #dbeafe;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      color: var(--text);
      background: var(--bg);
      min-height: 100vh;
      padding: 20px;
    }
    .container {
      max-width: 1400px;
      margin: 0 auto;
    }
    header {
      margin-bottom: 24px;
      padding-bottom: 20px;
      border-bottom: 2px solid var(--border);
    }
    h1 {
      font-size: 2.5rem;
      margin-bottom: 8px;
      background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .subtitle {
      color: var(--muted);
      font-size: 1.1rem;
    }
    
    .collapsible {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      margin-bottom: 24px;
      overflow: hidden;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .collapsible-header {
      padding: 16px 20px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 12px;
      font-weight: 600;
      font-size: 1.1rem;
      background: var(--accent-light);
      transition: background 0.2s;
      user-select: none;
    }
    .collapsible-header:hover {
      background: #bfdbfe;
    }
    .collapsible-icon {
      transition: transform 0.3s;
      font-size: 1.2rem;
    }
    .collapsible.collapsed .collapsible-icon {
      transform: rotate(-90deg);
    }
    .collapsible-content {
      max-height: 500px;
      overflow: hidden;
      transition: max-height 0.3s ease-out, padding 0.3s;
      padding: 20px;
    }
    .collapsible.collapsed .collapsible-content {
      max-height: 0;
      padding: 0 20px;
    }
    .directions-list {
      list-style: none;
      padding: 0;
    }
    .directions-list li {
      padding: 12px;
      margin-bottom: 8px;
      background: var(--card);
      border-radius: 8px;
      border-left: 3px solid var(--accent);
      display: flex;
      gap: 12px;
    }
    .step-number {
      background: var(--accent);
      color: white;
      width: 28px;
      height: 28px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 0.9rem;
      flex-shrink: 0;
    }
    .step-content {
      flex: 1;
    }
    .step-content strong {
      color: var(--text);
      display: block;
      margin-bottom: 4px;
    }
    .step-content span {
      color: var(--muted);
      font-size: 0.95rem;
    }
    code {
      background: var(--card);
      padding: 2px 6px;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      font-size: 0.9em;
      color: var(--accent);
    }
    
    .controls {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      align-items: center;
      margin-bottom: 24px;
      padding: 20px;
      background: var(--surface);
      border-radius: 12px;
      border: 1px solid var(--border);
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .btn {
      padding: 10px 20px;
      font-size: 0.95rem;
      font-weight: 600;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .btn-primary {
      background: var(--accent);
      color: white;
    }
    .btn-primary:hover {
      background: var(--accent-hover);
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
    }
    .btn-secondary {
      background: var(--surface);
      color: var(--text);
      border: 1px solid var(--border);
    }
    .btn-secondary:hover {
      background: var(--card);
    }
    .status-badge {
      padding: 8px 16px;
      border-radius: 20px;
      font-weight: 600;
      font-size: 0.9rem;
      margin-left: auto;
      border: 1px solid;
    }
    .status-idle { 
      background: var(--card); 
      color: var(--muted);
      border-color: var(--border);
    }
    .status-running { 
      background: #fef3c7; 
      color: #92400e;
      border-color: #fcd34d;
    }
    .status-success { 
      background: #d1fae5; 
      color: #065f46;
      border-color: #6ee7b7;
    }
    .status-error { 
      background: #fee2e2; 
      color: #991b1b;
      border-color: #fca5a5;
    }
    
    .grid {
      display: grid;
      gap: 20px;
      grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
      margin-bottom: 32px;
    }
    .card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 20px;
      transition: transform 0.2s, box-shadow 0.2s;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(0,0,0,0.12);
    }
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
      padding-bottom: 12px;
      border-bottom: 1px solid var(--border);
    }
    .card h3 {
      font-size: 1.3rem;
      color: var(--text);
    }
    .endpoint-badge {
      padding: 4px 10px;
      background: var(--accent-light);
      border-radius: 6px;
      font-size: 0.85rem;
      font-family: 'Courier New', monospace;
      color: var(--accent);
      border: 1px solid var(--accent);
    }
    
    .checklist {
      list-style: none;
      padding: 0;
    }
    .checklist-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 14px;
      margin-bottom: 8px;
      background: var(--card);
      border-radius: 8px;
      border-left: 3px solid transparent;
      transition: all 0.2s;
      border: 1px solid var(--border);
    }
    .checklist-item:hover {
      background: #e0e7ff;
    }
    .checklist-item.success {
      border-left-color: var(--ok);
      background: #d1fae5;
      border-color: #6ee7b7;
    }
    .checklist-item.error {
      border-left-color: var(--bad);
      background: #fee2e2;
      border-color: #fca5a5;
    }
    .check-icon {
      font-size: 1.5rem;
      min-width: 24px;
    }
    .check-label {
      flex: 1;
      font-weight: 500;
    }
    .check-time {
      color: var(--muted);
      font-size: 0.85rem;
      font-family: 'Courier New', monospace;
    }
    
    .json-viewer {
      background: #1e293b;
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 16px;
      max-height: 400px;
      overflow: auto;
      font-family: 'Courier New', monospace;
      font-size: 0.85rem;
      line-height: 1.6;
      color: #e2e8f0;
    }
    .json-viewer::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    .json-viewer::-webkit-scrollbar-track {
      background: #0f172a;
    }
    .json-viewer::-webkit-scrollbar-thumb {
      background: #475569;
      border-radius: 4px;
    }
    
    .table-container {
      overflow-x: auto;
      border-radius: 8px;
      border: 1px solid var(--border);
    }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.9rem;
      background: var(--surface);
    }
    thead {
      background: var(--card);
    }
    th {
      padding: 12px;
      text-align: left;
      font-weight: 600;
      color: var(--text);
      border-bottom: 2px solid var(--border);
    }
    td {
      padding: 12px;
      border-bottom: 1px solid var(--border);
    }
    tbody tr:hover {
      background: var(--card);
    }
    tbody tr:last-child td {
      border-bottom: none;
    }
    
    .view-toggle {
      display: flex;
      gap: 8px;
      margin-bottom: 16px;
    }
    .view-btn {
      padding: 6px 12px;
      background: var(--surface);
      border: 1px solid var(--border);
      color: var(--muted);
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.85rem;
      transition: all 0.2s;
    }
    .view-btn.active {
      background: var(--accent);
      color: white;
      border-color: var(--accent);
    }
    .view-btn:hover:not(.active) {
      background: var(--card);
    }
    
    .empty-state {
      text-align: center;
      padding: 40px;
      color: var(--muted);
    }
    .empty-state-icon {
      font-size: 3rem;
      margin-bottom: 12px;
      opacity: 0.5;
    }
    
    .input-group {
      display: flex;
      gap: 8px;
      margin-top: 12px;
    }
    .input-group input {
      flex: 1;
      padding: 8px 12px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 6px;
      color: var(--text);
      font-size: 0.9rem;
    }
    .input-group input:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }
    .input-group .btn {
      padding: 8px 16px;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>JoinUp API Route Tester</h1>
      <p class="subtitle">Test and monitor your API endpoints with live data validation</p>
    </header>

    <div class="collapsible" id="directions">
      <div class="collapsible-header" onclick="toggleCollapsible('directions')">
        <span class="collapsible-icon">‚ñº</span>
        <span>üìñ Quick Start Guide</span>
      </div>
      <div class="collapsible-content">
        <ul class="directions-list">
          <li>
            <div class="step-number">1</div>
            <div class="step-content">
              <strong>Start Your Server</strong>
              <span>Make sure your backend is running at <code>http://localhost:8080</code></span>
            </div>
          </li>
          <li>
            <div class="step-number">2</div>
            <div class="step-content">
              <strong>Run All Tests</strong>
              <span>Click the "Run All Tests" button to automatically check all endpoints</span>
            </div>
          </li>
          <li>
            <div class="step-number">3</div>
            <div class="step-content">
              <strong>View Results</strong>
              <span>Toggle between JSON and Table views to inspect the response data</span>
            </div>
          </li>
          <li>
            <div class="step-number">4</div>
            <div class="step-content">
              <strong>Custom Requests</strong>
              <span>Use the input fields below each endpoint to send custom queries (e.g., <code>?eventId=2</code>)</span>
            </div>
          </li>
          <li>
            <div class="step-number">5</div>
            <div class="step-content">
              <strong>Auto-Refresh</strong>
              <span>Enable auto-refresh to continuously monitor your endpoints every 5 seconds</span>
            </div>
          </li>
        </ul>
      </div>
    </div>

    <div class="controls">
      <button class="btn btn-primary" onclick="runAll()">
        <span>‚ñ∂</span> Run All Tests
      </button>
      <button class="btn btn-secondary" onclick="clearChecklist()">
        <span>‚Üª</span> Clear Results
      </button>
      <button class="btn btn-secondary" onclick="toggleAutoRefresh()">
        <span id="autoRefreshIcon">‚è∏</span> <span id="autoRefreshText">Auto-refresh</span>
      </button>
      <span id="summary" class="status-badge status-idle">Idle</span>
    </div>

    <div class="card" style="margin-bottom: 24px;">
      <div class="card-header">
        <h3>Quick Status</h3>
      </div>
      <ul class="checklist">
        <li class="checklist-item" id="chk-events">
          <span class="check-icon">‚¨ú</span>
          <span class="check-label">Events Endpoint</span>
          <span class="check-time" id="time-events"></span>
        </li>
        <li class="checklist-item" id="chk-attendees">
          <span class="check-icon">‚¨ú</span>
          <span class="check-label">Attendees Endpoint</span>
          <span class="check-time" id="time-attendees"></span>
        </li>
        <li class="checklist-item" id="chk-checkins">
          <span class="check-icon">‚¨ú</span>
          <span class="check-label">Check-ins Endpoint</span>
          <span class="check-time" id="time-checkins"></span>
        </li>
      </ul>
    </div>

    <div class="grid">
      <div class="card">
        <div class="card-header">
          <h3>Events</h3>
          <span class="endpoint-badge">GET /api/events</span>
        </div>
        <div class="view-toggle">
          <button class="view-btn active" onclick="switchView('events', 'json')">JSON</button>
          <button class="view-btn" onclick="switchView('events', 'table')">Table</button>
        </div>
        <div id="view-events-json" class="json-viewer">
          <div class="empty-state">
            <div class="empty-state-icon">üì¶</div>
            <div>Run tests to see results</div>
          </div>
        </div>
        <div id="view-events-table" class="table-container" style="display:none;">
          <div class="empty-state">
            <div class="empty-state-icon">üì¶</div>
            <div>Run tests to see results</div>
          </div>
        </div>
        <div class="input-group">
          <input type="text" placeholder="Send custom request..." id="custom-events">
          <button class="btn btn-primary" onclick="sendCustom('events')">Send</button>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <h3>Attendees</h3>
          <span class="endpoint-badge">GET /api/attendees</span>
        </div>
        <div class="view-toggle">
          <button class="view-btn active" onclick="switchView('attendees', 'json')">JSON</button>
          <button class="view-btn" onclick="switchView('attendees', 'table')">Table</button>
        </div>
        <div id="view-attendees-json" class="json-viewer">
          <div class="empty-state">
            <div class="empty-state-icon">üì¶</div>
            <div>Run tests to see results</div>
          </div>
        </div>
        <div id="view-attendees-table" class="table-container" style="display:none;">
          <div class="empty-state">
            <div class="empty-state-icon">üì¶</div>
            <div>Run tests to see results</div>
          </div>
        </div>
        <div class="input-group">
          <input type="text" placeholder="Send custom request..." id="custom-attendees">
          <button class="btn btn-primary" onclick="sendCustom('attendees')">Send</button>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <h3>Check-ins</h3>
          <span class="endpoint-badge">GET /api/checkins</span>
        </div>
        <div class="view-toggle">
          <button class="view-btn active" onclick="switchView('checkins', 'json')">JSON</button>
          <button class="view-btn" onclick="switchView('checkins', 'table')">Table</button>
        </div>
        <div id="view-checkins-json" class="json-viewer">
          <div class="empty-state">
            <div class="empty-state-icon">üì¶</div>
            <div>Run tests to see results</div>
          </div>
        </div>
        <div id="view-checkins-table" class="table-container" style="display:none;">
          <div class="empty-state">
            <div class="empty-state-icon">üì¶</div>
            <div>Run tests to see results</div>
          </div>
        </div>
        <div class="input-group">
          <input type="text" placeholder="?eventId=1" id="custom-checkins">
          <button class="btn btn-primary" onclick="sendCustom('checkins')">Send</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    const base = "http://localhost:8080";
    const S = id => document.getElementById(id);
    const T = ms => `${ms.toFixed(0)}ms`;
    
    let autoRefreshInterval = null;
    let currentViews = {events: 'json', attendees: 'json', checkins: 'json'};
    let lastData = {events: null, attendees: null, checkins: null};

    function toggleCollapsible(id) {
      const el = document.getElementById(id);
      el.classList.toggle('collapsed');
    }

    function switchView(endpoint, view) {
      currentViews[endpoint] = view;
      const jsonEl = S(`view-${endpoint}-json`);
      const tableEl = S(`view-${endpoint}-table`);
      
      jsonEl.style.display = view === 'json' ? 'block' : 'none';
      tableEl.style.display = view === 'table' ? 'block' : 'none';
      
      document.querySelectorAll(`[onclick*="switchView('${endpoint}"]`).forEach(btn => {
        btn.classList.remove('active');
      });
      event.target.classList.add('active');
      
      if (lastData[endpoint]) {
        renderData(endpoint, lastData[endpoint]);
      }
    }

    function renderJSON(data) {
      return `<pre>${JSON.stringify(data, null, 2)}</pre>`;
    }

    function renderTable(data) {
      if (!Array.isArray(data) || data.length === 0) {
        return '<div class="empty-state"><div class="empty-state-icon">üì≠</div><div>No data available</div></div>';
      }
      
      const keys = Object.keys(data[0]);
      let html = '<table><thead><tr>';
      keys.forEach(k => html += `<th>${k}</th>`);
      html += '</tr></thead><tbody>';
      
      data.slice(0, 10).forEach(row => {
        html += '<tr>';
        keys.forEach(k => {
          const val = row[k];
          const display = typeof val === 'object' ? JSON.stringify(val) : val;
          html += `<td>${display}</td>`;
        });
        html += '</tr>';
      });
      
      html += '</tbody></table>';
      if (data.length > 10) {
        html += `<div style="padding:12px;text-align:center;color:var(--muted);font-size:0.85rem">Showing 10 of ${data.length} rows</div>`;
      }
      return html;
    }

    function renderData(endpoint, data) {
      const view = currentViews[endpoint];
      const container = S(`view-${endpoint}-${view}`);
      
      if (view === 'json') {
        container.innerHTML = renderJSON(data);
      } else {
        container.innerHTML = renderTable(data);
      }
    }

    function mark(endpoint, ok, time) {
      const el = S(`chk-${endpoint}`);
      const timeEl = S(`time-${endpoint}`);
      
      if (ok) {
        el.className = 'checklist-item success';
        el.querySelector('.check-icon').textContent = '‚úÖ';
      } else {
        el.className = 'checklist-item error';
        el.querySelector('.check-icon').textContent = '‚ùå';
      }
      
      timeEl.textContent = time;
    }

    function clearChecklist() {
      ['events', 'attendees', 'checkins'].forEach(k => {
        const el = S(`chk-${k}`);
        el.className = 'checklist-item';
        el.querySelector('.check-icon').textContent = '‚¨ú';
        S(`time-${k}`).textContent = '';
        S(`view-${k}-json`).innerHTML = '<div class="empty-state"><div class="empty-state-icon">üì¶</div><div>Run tests to see results</div></div>';
        S(`view-${k}-table`).innerHTML = '<div class="empty-state"><div class="empty-state-icon">üì¶</div><div>Run tests to see results</div></div>';
        lastData[k] = null;
      });
      const badge = S('summary');
      badge.textContent = 'Idle';
      badge.className = 'status-badge status-idle';
    }

    async function probe(name, path) {
      const start = performance.now();
      let ok = false, data = null;
      
      try {
        const res = await fetch(base + path);
        ok = res.ok;
        data = await res.json();
      } catch (e) {
        ok = false;
        data = { error: String(e) };
      }
      
      const end = performance.now();
      const dur = T(end - start);
      
      mark(name, ok, dur);
      lastData[name] = data;
      renderData(name, data);
      
      return ok;
    }

    async function waitForSeed(timeoutMs = 8000) {
      const start = Date.now();
      while (Date.now() - start < timeoutMs) {
        try {
          const res = await fetch(base + "/api/events");
          if (res.ok) {
            const data = await res.json();
            if (Array.isArray(data) && data.length > 0) return true;
          }
        } catch {}
        await new Promise(r => setTimeout(r, 500));
      }
      return false;
    }

    async function runAll() {
      const badge = S('summary');
      badge.textContent = 'Waiting for seed data...';
      badge.className = 'status-badge status-running';
      
      const seeded = await waitForSeed();
      if (!seeded) {
        badge.textContent = 'Seed timeout (8s)';
        badge.className = 'status-badge status-error';
        return;
      }
      
      badge.textContent = 'Running tests...';
      
      const e = await probe('events', '/api/events');
      const a = await probe('attendees', '/api/attendees');
      const c = await probe('checkins', '/api/checkins?eventId=1');
      
      const all = e && a && c;
      badge.textContent = all ? '‚úÖ All tests passed' : '‚ö†Ô∏è Some tests failed';
      badge.className = all ? 'status-badge status-success' : 'status-badge status-error';
    }

    async function sendCustom(endpoint) {
      const input = S(`custom-${endpoint}`);
      const query = input.value.trim();
      const path = query.startsWith('?') || query.startsWith('/') 
        ? `/api/${endpoint}${query}` 
        : `/api/${endpoint}${query ? '?' + query : ''}`;
      
      await probe(endpoint, path);
    }

    function toggleAutoRefresh() {
      const icon = S('autoRefreshIcon');
      const text = S('autoRefreshText');
      
      if (autoRefreshInterval) {
        clearInterval(autoRefreshInterval);
        autoRefreshInterval = null;
        icon.textContent = '‚è∏';
        text.textContent = 'Auto-refresh';
      } else {
        autoRefreshInterval = setInterval(runAll, 5000);
        icon.textContent = '‚èµ';
        text.textContent = 'Auto-refresh (5s)';
        runAll();
      }
    }

    document.querySelectorAll('input').forEach(input => {
      input.addEventListener('keypress', e => {
        if (e.key === 'Enter') {
          const id = input.id.replace('custom-', '');
          sendCustom(id);
        }
      });
    });
  </script>
</body>
</html>