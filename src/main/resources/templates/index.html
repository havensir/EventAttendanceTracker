<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout :: shell(
        'home',
        ${'Hi ' + ((userName?:'Jane Doe').split(' ')[0]) + ', your events are just a click away.'},
        ~{::content}
      )}">

  <th:block th:fragment="content">
    <!-- Page-only tweaks -->
    <style>
      .checkin-panel{
      background:linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      border:2px solid #dee2e6;
      color:#212529;
      border-radius:16px;
      padding:24px 24px;
      margin: 32px;
      box-shadow:0 2px 8px rgba(0,0,0,0.06);
      }
      .checkin-panel p{margin:0 0 12px;font-size:18px;opacity:.9;font-weight:600}
      .codeRow{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
      .code{display:flex;gap:10px}
      .code input{
      width:44px;height:52px;text-align:center;font-size:22px;border-radius:12px;
      border:2px solid #ced4da;background:#fff;color:#212529;outline:none;transition:.15s;
      }
      .code input:focus{border-color:#495057;box-shadow:0 0 0 3px rgba(73,80,87,.12)}
      .dash{width:18px;height:3px;background:#495057;border-radius:999px;opacity:.5;margin:0 2px;align-self:center}
      .checkBtn{
      margin-top:12px;
      background:#3b2a17;
      color:#fff;
      font-weight:700;
      border:none;
      border-radius:12px;
      padding:12px 16px;
      min-width:280px;
      cursor:pointer;
      transition:.2s;
      }
      .checkBtn:hover{background:#2d1f0f}

      .grid{    margin: 32px;display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-top:20px;align-items:start}
      .card{background:#fff;border:1px solid #e6e6e6;border-radius:16px;padding:16px;display:flex;flex-direction:column;height:100%}
      .card h2{margin:0 0 8px;font-size:24px}
      .list{display:flex;flex-direction:column;gap:12px;margin-top:8px;flex:1}
      .row{display:grid;grid-template-columns:1fr auto;align-items:center;border:1px solid #e6e6e6;border-radius:12px;padding:12px;gap:12px}
      .row .meta{display:flex;flex-direction:column;gap:4px}
      .muted{color:#616161;font-size:14px}
      .viewBtn{
      background:#3b2a17;
      color:#fff;
      border:none;
      border-radius:10px;
      padding:8px 16px;
      cursor:pointer;
      font-weight:700;
      transition:.2s;
      white-space:nowrap;
      }
      .viewBtn:hover{background:#2d1f0f}
      .viewBtn:disabled{background:#ccc;cursor:not-allowed}
      .footerBtn{margin-top:12px;width:100%;padding:12px 14px;border-radius:12px;background:#e9e9e9;border:1px solid #e6e6e6;font-weight:800;cursor:pointer;transition:.2s}
      .footerBtn:hover{background:#ddd}
      @media (max-width:980px){.grid{grid-template-columns:1fr}}
    </style>

    <!-- Connected check-in panel (visual part only; wire later to POST /api/checkins) -->
    <section class="checkin-panel">
      <p>Arrived at an event? Let's get you checked in</p>
      <div class="codeRow">
        <div class="code" id="code">
          <!-- 4-4-4 inputs -->
          <input maxlength="1" inputmode="numeric"/>
          <input maxlength="1" inputmode="numeric"/>
          <input maxlength="1" inputmode="numeric"/>
          <input maxlength="1" inputmode="numeric"/>
          <div class="dash"></div>
          <input maxlength="1" inputmode="numeric"/>
          <input maxlength="1" inputmode="numeric"/>
          <input maxlength="1" inputmode="numeric"/>
          <input maxlength="1" inputmode="numeric"/>
          <div class="dash"></div>
          <input maxlength="1" inputmode="numeric"/>
          <input maxlength="1" inputmode="numeric"/>
          <input maxlength="1" inputmode="numeric"/>
          <input maxlength="1" inputmode="numeric"/>
        </div>
      </div>
      <button class="checkBtn" id="checkBtn" type="button">Check In Now</button>
    </section>

    <section class="grid">
      <!-- Your Tickets: show actual attendee registrations (demo: all attendees) -->
      <div class="card">
        <h2>Your Tickets</h2>
        <div class="list">

          <!-- Empty state -->
          <div class="row" th:if="${#lists.isEmpty(attendees)}">
            <div class="meta">
              <strong>No tickets yet</strong>
              <div class="muted">Registrations you create will appear here.</div>
            </div>
            <button class="viewBtn" type="button" disabled>View Ticket</button>
          </div>

          <!-- Render attendees; look up event details via eventsById -->
          <div class="row" th:each="a : ${attendees}">
            <div class="meta">
              <strong th:text="${eventsById[a.eventId]?.name} ?: 'Event'">Event Name</strong>
              <div class="muted">
                üìç <span th:text="${eventsById[a.eventId]?.location} ?: 'Location'">Location</span>
                &nbsp; üìÖ <span th:text="${eventsById[a.eventId]?.dateTime} ?: 'Date/Time'">Date/Time</span>
              </div>
              <div class="muted">üë§
                <span th:text="${a.firstName}">First</span>
                <span th:text="${a.lastName}">Last</span>
              </div>
            </div>
            <button class="viewBtn" type="button">View Ticket</button>
          </div>

          <button class="footerBtn" type="button">View All Tickets</button>
        </div>
      </div>

      <!-- Featured Events: iterate real events -->
      <div class="card">
        <h2>Featured Events</h2>
        <div class="list">
          <div class="row" th:if="${#lists.isEmpty(events)}">
            <div class="meta">
              <strong>No events yet</strong>
              <div class="muted">Seed data will appear here once available.</div>
            </div>
            <button class="viewBtn" type="button" disabled>View</button>
          </div>

          <div class="row" th:each="e : ${events}">
            <div class="meta">
              <strong th:text="${e.name}">Event Name</strong>
              <div class="muted">
                üìç <span th:text="${e.location}">Location</span>
                &nbsp; üìÖ <span th:text="${e.dateTime}">Date/Time</span>
              </div>
            </div>
            <button class="viewBtn" type="button">View</button>
          </div>

          <button class="footerBtn" type="button">View All Events</button>
        </div>
      </div>
    </section>

    <script>
      // auto-advance the 12-digit code inputs (4-4-4)
      const inputs = Array.from(document.querySelectorAll('#code input'));
      inputs.forEach((inp, i) => {
        inp.addEventListener('input', () => { if (inp.value && i < inputs.length - 1) inputs[i+1].focus(); });
        inp.addEventListener('keydown', (e) => { if (e.key === 'Backspace' && !inp.value && i > 0) inputs[i-1].focus(); });
      });

      document.getElementById('checkBtn')?.addEventListener('click', () => {
        const digits = inputs.map(i => i.value.trim()).filter(Boolean);
        const code = digits.slice(0,4).join('') + '-' + digits.slice(4,8).join('') + '-' + digits.slice(8,12).join('');
        alert(code.length >= 14 ? `Checking in with code: ${code}` : 'Please enter your full 12-digit code.');
        // TODO: wire to POST /api/checkins when ready
      });
    </script>
  </th:block>
</html>