<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout :: shell(
        'home',
        ${'Hi ' + ((userName?:'Jane Doe').split(' ')[0]) + ', your events are just a click away.'},
        ~{::content}
      )}">

  <th:block th:fragment="content">
    <!-- SVG Icon Sprite -->
    <svg xmlns="http://www.w3.org/2000/svg" style="display:none">
      <symbol id="i-check-circle" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8">
        <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4" />
        <circle cx="12" cy="12" r="9"></circle>
      </symbol>
      <symbol id="i-ticket" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8">
        <path stroke-linecap="round" stroke-linejoin="round" d="M3 9a3 3 0 003-3h12a3 3 0 003 3v6a3 3 0 00-3 3H6a3 3 0 00-3-3V9z" />
        <path d="M8 7v10m8-10v10" />
      </symbol>
      <symbol id="i-calendar" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8">
        <path stroke-linecap="round" stroke-linejoin="round" d="M8 3v3m8-3v3M4 9h16M5 7h14a1 1 0 011 1v11a2 2 0 01-2 2H6a2 2 0 01-2-2V8a1 1 0 011-1z" />
      </symbol>
      <symbol id="i-map-pin" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8">
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 21s7-6.2 7-11a7 7 0 10-14 0c0 4.8 7 11 7 11z" />
        <circle cx="12" cy="10" r="2.5"></circle>
      </symbol>
      <symbol id="i-user" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8">
        <path stroke-linecap="round" stroke-linejoin="round" d="M5 20a7 7 0 0114 0M12 12a4 4 0 100-8 4 4 0 000 8z" />
      </symbol>
      <symbol id="i-list-bullet" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8">
        <path stroke-linecap="round" stroke-linejoin="round" d="M8 6h12M8 12h12M8 18h12M4 6h.01M4 12h.01M4 18h.01" />
      </symbol>
      <symbol id="i-sparkles" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8">
        <path stroke-linecap="round" stroke-linejoin="round" d="M9 3l1.5 3L14 7.5 10.5 9 9 12 7.5 9 4 7.5 7.5 6 9 3zM17 13l1 2 2 1-2 1-1 2-1-2-2-1 2-1 1-2z" />
      </symbol>
      <symbol id="i-arrow-right" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8">
        <path stroke-linecap="round" stroke-linejoin="round" d="M5 12h14M13 5l7 7-7 7" />
      </symbol>
    </svg>

    <style>
      /* Layout container to keep consistent gutters for all sections */
      .page-wrap{max-width:1200px;margin:32px auto;padding:0 32px}

      .icon{width:20px;height:20px;display:inline-block;vertical-align:-4px;color:#3b2a17}
      .icon.lg{width:28px;height:28px}
      .icon.xl{width:40px;height:40px}

      .stats-bar{
        display:grid;grid-template-columns:repeat(auto-fit, minmax(220px, 1fr));
        gap:16px;margin:0 0 24px;
      }
      .stat-card{
        background:#fff;border:1px solid #e0d5c7;border-radius:16px;
        padding:18px 20px;transition:.2s ease;display:flex;align-items:center;gap:14px;
      }
      .stat-card:hover{border-color:#d4c4b0;box-shadow:0 4px 12px rgba(59,42,23,0.06)}
      .stat-number{font-size:30px;font-weight:800;color:#3b2a17;margin:0}
      .stat-label{font-size:14px;color:#6b5d4f;margin:2px 0 0;font-weight:600}
      .stat-meta{display:flex;flex-direction:column}

      /* Check-in lives inside page-wrap; spans its full width */
      .checkin-panel{
        background:#fff;border:1px solid #e0d5c7;border-radius:20px;
        padding:28px;box-shadow:0 2px 12px rgba(59,42,23,0.06);margin:0 0 24px;
      }
      .checkin-title{display:flex;align-items:center;justify-content:center;gap:10px;margin-bottom:4px}
      .checkin-panel h3{margin:0;font-size:22px;font-weight:800;color:#3b2a17;text-align:center}
      .checkin-panel p{margin:0 0 20px;font-size:14px;color:#6b5d4f;text-align:center}

      .code{display:flex;gap:10px;justify-content:center;margin-bottom:20px;flex-wrap:wrap}
      .code input{
        width:52px;height:60px;text-align:center;font-size:26px;border-radius:12px;
        border:2px solid #e0d5c7;background:#fafaf8;color:#3b2a17;outline:none;
        transition:all .2s ease;font-weight:600;
      }
      .code input:focus{border-color:#3b2a17;background:#fff;box-shadow:0 0 0 3px rgba(59,42,23,.08)}
      .code input.filled{border-color:#3b2a17;background:#fff}
      .dash{width:12px;height:3px;background:#3b2a17;border-radius:999px;opacity:.3;align-self:center;margin:0 2px}

      .checkBtn{
        width:100%;background:#3b2a17;color:#fff;font-weight:700;border:none;
        border-radius:12px;padding:14px 20px;cursor:pointer;transition:.2s ease;
        font-size:15px;margin-bottom:12px;
      }
      .checkBtn:hover{background:#2d1f0f}
      .checkBtn:disabled{background:#d4c4b0;cursor:not-allowed;opacity:.6}

      .resend-link{text-align:center;font-size:14px;color:#6b5d4f}
      .resend-link button{background:none;border:none;color:#3b2a17;font-weight:700;cursor:pointer;text-decoration:underline;padding:0}
      .resend-link button:hover{color:#2d1f0f}

      .grid{
        display:grid;grid-template-columns:1fr 1fr;gap:24px;align-items:start;
      }
      .card{
        background:#fff;border:1px solid #e0d5c7;border-radius:20px;
        padding:24px;display:flex;flex-direction:column;height:100%;
        box-shadow:0 2px 8px rgba(59,42,23,0.04);transition:.2s ease;
      }
      .card:hover{box-shadow:0 4px 16px rgba(59,42,23,0.08)}
      .card-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px}
      .card-title{display:flex;align-items:center;gap:10px}
      .card h2{margin:0;font-size:24px;color:#3b2a17;font-weight:800}
      .badge{
        background:#f5f1ed;color:#3b2a17;padding:4px 12px;border-radius:20px;
        font-size:12px;font-weight:700;display:flex;align-items:center;gap:6px;
      }

      .list{display:flex;flex-direction:column;gap:12px;flex:1}
      .row{
        display:grid;grid-template-columns:1fr auto;align-items:center;
        border:1px solid #e9e4dd;border-radius:14px;padding:16px;gap:16px;
        background:#fafaf8;transition:.2s ease;
      }
      .row:hover{border-color:#d4c4b0;background:#fff;box-shadow:0 2px 8px rgba(59,42,23,0.04)}
      .row .meta{display:flex;flex-direction:column;gap:6px}
      .row .meta strong{color:#3b2a17;font-size:16px}
      .muted{color:#8b7d6f;font-size:14px;line-height:1.5;display:flex;align-items:center;gap:8px}

      .viewBtn{
        display:inline-flex;align-items:center;gap:8px;background:#3b2a17;color:#fff;border:none;
        border-radius:10px;padding:10px 18px;cursor:pointer;font-weight:700;
        transition:.2s ease;white-space:nowrap;text-decoration:none;
        font-size:14px;box-shadow:0 2px 6px rgba(59,42,23,0.15);
      }
      .viewBtn:hover{background:#2d1f0f;transform:translateY(-1px);box-shadow:0 4px 10px rgba(59,42,23,0.25)}
      .viewBtn[disabled]{background:#ccc;cursor:not-allowed;box-shadow:none}

      .footerBtn{
        margin-top:16px;width:100%;padding:14px 16px;border-radius:12px;
        background:#f5f1ed;border:1px solid #e0d5c7;font-weight:700;
        cursor:pointer;transition:.2s ease;text-align:center;text-decoration:none;
        color:#3b2a17;font-size:15px;display:inline-flex;align-items:center;justify-content:center;gap:8px;
      }
      .footerBtn:hover{background:#ebe6e0;border-color:#d4c4b0}

      .empty-state{text-align:center;padding:20px;opacity:.85}
      .empty-icon{display:inline-flex;align-items:center;justify-content:center;width:64px;height:64px;border-radius:16px;background:#f5f1ed;margin-bottom:10px}

      @media (max-width:980px){
        .grid{grid-template-columns:1fr}
        .stats-bar{grid-template-columns:1fr 1fr}
      }
      @media (max-width:600px){
        .code{gap:8px}
        .code input{width:46px;height:54px;font-size:22px}
        .stats-bar{grid-template-columns:1fr}
        .page-wrap{padding:0 16px}
      }
    </style>

    <div class="page-wrap">
      <!-- Quick Stats -->
      <section class="stats-bar">
        <div class="stat-card">
          <svg class="icon lg" aria-hidden="true"><use href="#i-ticket"></use></svg>
          <div class="stat-meta">
            <div class="stat-number" th:text="${attendees.size()}">0</div>
            <div class="stat-label">Active Tickets</div>
          </div>
        </div>
        <div class="stat-card">
          <svg class="icon lg" aria-hidden="true"><use href="#i-sparkles"></use></svg>
          <div class="stat-meta">
            <div class="stat-number" th:text="${events.size()}">0</div>
            <div class="stat-label">Featured Events</div>
          </div>
        </div>
        <div class="stat-card">
          <svg class="icon lg" aria-hidden="true"><use href="#i-check-circle"></use></svg>
          <div class="stat-meta">
            <div class="stat-number" aria-label="Ready">Ready</div>
            <div class="stat-label">Ready to Check In</div>
          </div>
        </div>
      </section>

      <!-- Check-in (full width inside page-wrap) -->
      <section class="checkin-panel">
        <div class="checkin-title">
          <h3>Check-In Code</h3>
        </div>
        <p>Enter your 12-digit event code</p>

        <div class="code" id="code">
          <input maxlength="1" inputmode="numeric" autocomplete="off"/>
          <input maxlength="1" inputmode="numeric" autocomplete="off"/>
          <input maxlength="1" inputmode="numeric" autocomplete="off"/>
          <input maxlength="1" inputmode="numeric" autocomplete="off"/>
          <div class="dash"></div>
          <input maxlength="1" inputmode="numeric" autocomplete="off"/>
          <input maxlength="1" inputmode="numeric" autocomplete="off"/>
          <input maxlength="1" inputmode="numeric" autocomplete="off"/>
          <input maxlength="1" inputmode="numeric" autocomplete="off"/>
          <div class="dash"></div>
          <input maxlength="1" inputmode="numeric" autocomplete="off"/>
          <input maxlength="1" inputmode="numeric" autocomplete="off"/>
          <input maxlength="1" inputmode="numeric" autocomplete="off"/>
          <input maxlength="1" inputmode="numeric" autocomplete="off"/>
        </div>

        <button class="checkBtn" id="checkBtn" type="button" disabled>Check In</button>

        <div class="resend-link">
          Don't have a code? <button type="button" id="helpBtn">Get Help</button>
        </div>
      </section>

      <!-- Two-column content -->
      <section class="grid">
        <!-- Your Tickets -->
        <div class="card">
          <div class="card-header">
            <div class="card-title">
              <svg class="icon lg" aria-hidden="true"><use href="#i-ticket"></use></svg>
              <h2>Your Tickets</h2>
            </div>
            <span class="badge">
              <svg class="icon" aria-hidden="true"><use href="#i-list-bullet"></use></svg>
              <span th:text="${attendees.size()} + ' total'">0 total</span>
            </span>
          </div>
          <div class="list">
            <!-- Empty state -->
            <div class="empty-state" th:if="${#lists.isEmpty(attendees)}">
              <div class="empty-icon">
                <svg class="icon xl" aria-hidden="true"><use href="#i-ticket"></use></svg>
              </div>
              <strong style="display:block;margin-bottom:6px;color:#3b2a17">No tickets yet</strong>
              <div class="muted" style="justify-content:center">Your registrations will appear here.</div>
            </div>

            <!-- Render attendees -->
            <div class="row" th:each="a : ${attendees}">
              <div class="meta">
                <strong th:text="${eventsById[a.eventId]?.name} ?: 'Event'">Event Name</strong>
                <div class="muted">
                  <svg class="icon" aria-hidden="true"><use href="#i-map-pin"></use></svg>
                  <span th:text="${eventsById[a.eventId]?.location} ?: 'Location'">Location</span>
                </div>
                <div class="muted">
                  <svg class="icon" aria-hidden="true"><use href="#i-calendar"></use></svg>
                  <span th:text="${eventsById[a.eventId]?.dateTime} ?: 'Date/Time'">Date/Time</span>
                </div>
                <div class="muted">
                  <svg class="icon" aria-hidden="true"><use href="#i-user"></use></svg>
                  <span th:text="${a.firstName}">First</span>
                  <span th:text="${a.lastName}">Last</span>
                </div>
              </div>
              <a class="viewBtn" th:href="@{|/ui/tickets/${a.id}|}">
                View Ticket <svg class="icon" aria-hidden="true"><use href="#i-arrow-right"></use></svg>
              </a>
            </div>

            <a class="footerBtn" th:href="@{/ui/events/my}">
              View All Tickets <svg class="icon" aria-hidden="true"><use href="#i-arrow-right"></use></svg>
            </a>
          </div>
        </div>

        <!-- Featured Events -->
        <div class="card">
          <div class="card-header">
            <div class="card-title">
              <svg class="icon lg" aria-hidden="true"><use href="#i-sparkles"></use></svg>
              <h2>Featured Events</h2>
            </div>
            <span class="badge">
              <svg class="icon" aria-hidden="true"><use href="#i-list-bullet"></use></svg>
              <span th:text="${events.size()} + ' available'">0 available</span>
            </span>
          </div>
          <div class="list">
            <!-- Empty state -->
            <div class="empty-state" th:if="${#lists.isEmpty(events)}">
              <div class="empty-icon">
                <svg class="icon xl" aria-hidden="true"><use href="#i-calendar"></use></svg>
              </div>
              <strong style="display:block;margin-bottom:6px;color:#3b2a17">No events yet</strong>
              <div class="muted" style="justify-content:center">Check back soon for upcoming events.</div>
            </div>

            <!-- Render events -->
            <div class="row" th:each="e : ${events}">
              <div class="meta">
                <strong th:text="${e.name}">Event Name</strong>
                <div class="muted">
                  <svg class="icon" aria-hidden="true"><use href="#i-map-pin"></use></svg>
                  <span th:text="${e.location}">Location</span>
                </div>
                <div class="muted">
                  <svg class="icon" aria-hidden="true"><use href="#i-calendar"></use></svg>
                  <span th:text="${e.dateTime}">Date/Time</span>
                </div>
              </div>
              <a class="viewBtn" th:href="@{|/ui/events/${e.id}|}">
                View Event <svg class="icon" aria-hidden="true"><use href="#i-arrow-right"></use></svg>
              </a>
            </div>

            <a class="footerBtn" th:href="@{/ui/events}">
              Browse All Events <svg class="icon" aria-hidden="true"><use href="#i-arrow-right"></use></svg>
            </a>
          </div>
        </div>
      </section>
    </div>

    <script>
      // Check-in code logic
      const inputs = Array.from(document.querySelectorAll('#code input'));

      inputs.forEach((inp, i) => {
        inp.addEventListener('input', () => {
          const val = inp.value.replace(/\D/g, '');
          inp.value = val;
          if (val) {
            inp.classList.add('filled');
            if (i < inputs.length - 1) inputs[i+1].focus();
          } else {
            inp.classList.remove('filled');
          }
          updateCheckButton();
        });

        inp.addEventListener('keydown', (e) => {
          if (e.key === 'Backspace' && !inp.value && i > 0) inputs[i-1].focus();
        });

        inp.addEventListener('paste', (e) => {
          e.preventDefault();
          const paste = (e.clipboardData || window.clipboardData).getData('text').replace(/\D/g, '');
          paste.split('').forEach((char, idx) => {
            if (i + idx < inputs.length) {
              inputs[i + idx].value = char;
              inputs[i + idx].classList.add('filled');
            }
          });
          const nextEmpty = inputs.findIndex((el, idx) => idx >= i && !el.value);
          if (nextEmpty !== -1) inputs[nextEmpty].focus();
          updateCheckButton();
        });
      });

      function updateCheckButton() {
        const filled = inputs.filter(i => i.value.trim()).length;
        const btn = document.getElementById('checkBtn');
        btn.disabled = filled < 12;
      }

      document.getElementById('checkBtn')?.addEventListener('click', () => {
        const digits = inputs.map(i => i.value.trim());
        const code = digits.slice(0,4).join('') + '-' + digits.slice(4,8).join('') + '-' + digits.slice(8,12).join('');
        alert(`Checking in with code: ${code}`);
        // TODO: POST /api/checkins
      });

      document.getElementById('helpBtn')?.addEventListener('click', () => {
        alert('Your check-in code can be found on your event ticket. Contact support if you need assistance.');
      });

      updateCheckButton();
    </script>
  </th:block>
</html>
