<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout :: shell(
        'home',
        ${'Hi ' + ((userName?:'Jane Doe').split(' ')[0]) + ', your events are just a click away.'},
        ~{::content}
      )}">

  <th:block th:fragment="content">
    <!-- Page-only tweaks -->
    <style>
      .checkin-panel{background:#1f3f2f;color:#fff;border-radius:16px;padding:24px 24px;margin-bottom:22px}
      .checkin-panel p{margin:0 0 12px;font-size:18px;opacity:.92}
      .codeRow{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
      .code{display:flex;gap:10px}
      .code input{
        width:44px;height:52px;text-align:center;font-size:22px;border-radius:12px;
        border:2px solid rgba(255,255,255,.35);background:transparent;color:#fff;outline:none;transition:.15s;
      }
      .code input:focus{border-color:#fff;box-shadow:0 0 0 3px rgba(255,255,255,.12)}
      .dash{width:18px;height:3px;background:#fff;border-radius:999px;opacity:.7;margin:0 2px}
      .checkBtn{margin-top:12px;background:#efe5b6;color:#222;font-weight:800;border:none;border-radius:12px;padding:12px 16px;min-width:280px;cursor:pointer}

      .grid{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-top:20px}
      .card{background:#fff;border:1px solid #e6e6e6;border-radius:16px;padding:16px}
      .card h2{margin:0 0 8px;font-size:24px}
      .list{display:flex;flex-direction:column;gap:12px;margin-top:8px}
      .row{display:grid;grid-template-columns:1fr 104px;align-items:center;border:1px solid #e6e6e6;border-radius:12px;overflow:hidden}
      .row .meta{padding:12px}
      .muted{color:#616161;font-size:14px}
      .barcode{display:grid;place-items:center;background:#000;color:#fff;height:76px}
      .viewBtn{background:#3b2a17;color:#fff;border:none;border-radius:10px;padding:8px 12px;cursor:pointer;font-weight:700}
      .footerBtn{margin-top:12px;width:100%;padding:12px 14px;border-radius:12px;background:#e9e9e9;border:1px solid #e6e6e6;font-weight:800;cursor:pointer}
      @media (max-width:980px){.grid{grid-template-columns:1fr}}
    </style>

    <!-- Connected check-in panel (visual part only; wire later to POST /api/checkins) -->
    <section class="checkin-panel">
      <p>Arrived at an event? Let‚Äôs get you checked in</p>
      <div class="codeRow">
        <div class="code" id="code">
          <!-- 4-4-4 inputs -->
          <input maxlength="1" inputmode="numeric"/>
          <input maxlength="1" inputmode="numeric"/>
          <input maxlength="1" inputmode="numeric"/>
          <input maxlength="1" inputmode="numeric"/>
          <div class="dash"></div>
          <input maxlength="1" inputmode="numeric"/>
          <input maxlength="1" inputmode="numeric"/>
          <input maxlength="1" inputmode="numeric"/>
          <input maxlength="1" inputmode="numeric"/>
          <div class="dash"></div>
          <input maxlength="1" inputmode="numeric"/>
          <input maxlength="1" inputmode="numeric"/>
          <input maxlength="1" inputmode="numeric"/>
          <input maxlength="1" inputmode="numeric"/>
        </div>
      </div>
      <button class="checkBtn" id="checkBtn" type="button">Check In Now</button>
    </section>

    <section class="grid">
      <!-- Your Tickets: show actual attendee registrations (demo: all attendees) -->
      <div class="card">
        <h2>Your Tickets</h2>
        <div class="list">

          <!-- Empty state -->
          <div class="row" th:if="${#lists.isEmpty(attendees)}">
            <div class="meta">
              <strong>No tickets yet</strong>
              <div class="muted">Registrations you create will appear here.</div>
            </div>
            <div class="barcode" aria-hidden="true">‚ñÆ‚ñÆ‚ñØ‚ñØ‚ñÆ‚ñØ</div>
          </div>

          <!-- Render attendees; look up event details via eventsById -->
          <div class="row" th:each="a : ${attendees}">
            <div class="meta">
              <strong th:text="${eventsById[a.eventId]?.name} ?: 'Event'">Event Name</strong>
              <div class="muted">
                üìç <span th:text="${eventsById[a.eventId]?.location} ?: 'Location'">Location</span>
                &nbsp; üìÖ <span th:text="${eventsById[a.eventId]?.dateTime} ?: 'Date/Time'">Date/Time</span>
              </div>
              <div class="muted">üë§
                <span th:text="${a.firstName}">First</span>
                <span th:text="${a.lastName}">Last</span>
              </div>
            </div>
            <div class="barcode" aria-hidden="true">
              <!-- simple barcode look -->
              <svg width="64" height="48" viewBox="0 0 64 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                <rect x="2" y="6" width="4" height="36" fill="#fff"/><rect x="10" y="6" width="2" height="36" fill="#fff"/>
                <rect x="16" y="6" width="6" height="36" fill="#fff"/><rect x="26" y="6" width="3" height="36" fill="#fff"/>
                <rect x="33" y="6" width="2" height="36" fill="#fff"/><rect x="38" y="6" width="6" height="36" fill="#fff"/>
                <rect x="48" y="6" width="2" height="36" fill="#fff"/><rect x="54" y="6" width="4" height="36" fill="#fff"/>
              </svg>
            </div>
          </div>

          <button class="footerBtn" type="button">View All Tickets</button>
        </div>
      </div>

      <!-- Featured Events: iterate real events -->
      <div class="card">
        <h2>Featured Events</h2>
        <div class="list">
          <div class="row" th:if="${#lists.isEmpty(events)}">
            <div class="meta">
              <strong>No events yet</strong>
              <div class="muted">Seed data will appear here once available.</div>
            </div>
            <div style="padding:12px;display:grid;place-items:center">
              <button class="viewBtn" type="button" disabled>View</button>
            </div>
          </div>

          <div class="row" th:each="e : ${events}">
            <div class="meta">
              <strong th:text="${e.name}">Event Name</strong>
              <div class="muted">
                üìç <span th:text="${e.location}">Location</span>
                &nbsp; üìÖ <span th:text="${e.dateTime}">Date/Time</span>
              </div>
            </div>
            <div style="padding:12px;display:grid;place-items:center">
              <button class="viewBtn" type="button">View</button>
            </div>
          </div>

          <button class="footerBtn" type="button">View All Events</button>
        </div>
      </div>
    </section>

    <script>
      // auto-advance the 12-digit code inputs (4-4-4)
      const inputs = Array.from(document.querySelectorAll('#code input'));
      inputs.forEach((inp, i) => {
        inp.addEventListener('input', () => { if (inp.value && i < inputs.length - 1) inputs[i+1].focus(); });
        inp.addEventListener('keydown', (e) => { if (e.key === 'Backspace' && !inp.value && i > 0) inputs[i-1].focus(); });
      });

      document.getElementById('checkBtn')?.addEventListener('click', () => {
        const digits = inputs.map(i => i.value.trim()).filter(Boolean);
        const code = digits.slice(0,4).join('') + '-' + digits.slice(4,8).join('') + '-' + digits.slice(8,12).join('');
        alert(code.length >= 14 ? `Checking in with code: ${code}` : 'Please enter your full 12-digit code.');
        // TODO: wire to POST /api/checkins when ready
      });
    </script>
  </th:block>
</html>
